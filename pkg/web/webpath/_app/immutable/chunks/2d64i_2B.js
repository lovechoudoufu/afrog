import{g as c,a as u}from"./DsUGc709.js";const l="/api";class n extends Error{constructor(e,t,s){super(s),this.status=e,this.response=t,this.name="ApiError"}}class p{baseUrl;constructor(e=l){this.baseUrl=e}async request(e,t={}){const s=`${this.baseUrl}${e}`,o=c(),a={headers:{"Content-Type":"application/json",...t.headers},...t};o&&(a.headers={...a.headers,Authorization:`Bearer ${o}`});try{const r=await fetch(s,a);if(r.status===401)throw u.removeToken(),new n(401,null,"登录过期，请重新登录");if(!r.ok){const i=await r.json().catch(()=>({}));throw new n(r.status,i,i.message||`HTTP ${r.status}: ${r.statusText}`)}return await r.json()}catch(r){throw r instanceof n?r:new n(0,null,"网络错误，请检查连接后重试")}}post(e,t){return this.request(e,{method:"POST",body:t?JSON.stringify(t):void 0})}get(e){return this.request(e,{method:"GET"})}async login(e){return this.post("/login",{password:e})}async loadVulns(){return this.get("/vulns")}async loadPocsStats(){return this.get("/pocs/stats")}async loadReports(e){const t=new URLSearchParams;e?.page&&t.set("page",String(e.page)),e?.page_size&&t.set("page_size",String(e.page_size)),e?.keyword&&t.set("keyword",e.keyword),e?.severity&&t.set("severity",e.severity);const s=t.toString()?`/reports?${t.toString()}`:"/reports";return this.get(s)}async getReportDetail(e,t={expand:"all"}){const s=new URLSearchParams;t.expand&&s.set("expand",t.expand);const o=`/reports/detail/${e}${s.toString()?"?"+s.toString():""}`;return this.get(o)}async getPocContent(e){try{const t=await fetch(`${this.baseUrl}/reports/poc/${e}`,{method:"GET",headers:{Authorization:`Bearer ${c()}`,"Content-Type":"application/json"}});if(!t.ok)throw new n(t.status,null,`HTTP ${t.status}`);return{success:!0,message:"POC内容获取成功",data:await t.text()}}catch(t){throw t instanceof n?t:new n(0,t,"网络错误，请检查连接后重试")}}}const d=new p;export{n as A,d as a};
