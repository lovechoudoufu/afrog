const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/BvHLSZtD.js","../assets/monaco-config.IzS7Fgq3.css"])))=>i.map(i=>d[i]);
import"../chunks/DsnmJJEf.js";import{a4 as se,I as Ue,g as t,u as S,a3 as p,i as _t,a2 as Je,p as Oe,L as ye,a as R,b as a,c as Me,M as Ne,f as w,d as c,N as Xe,r as l,aq as Be,s as u,e as b,t as F,n as x,k as Re}from"../chunks/CitxP-cn.js";import"../chunks/DaTyf_B5.js";import{o as yt,s as O,d as Pt}from"../chunks/BWd9SBbi.js";import{i as J,b as pt}from"../chunks/sN7Q9I87.js";import{a as je,i as Qe}from"../chunks/BRjDXSjs.js";import{c as De}from"../chunks/ChoeLdCe.js";import{p as B,r as Ve,b as Ze}from"../chunks/CptUsCsW.js";import{S as bt,L as Ge,B as ve,C as ut}from"../chunks/BHOvQ0ni.js";import{B as G}from"../chunks/BGyC5AxN.js";import{I as xt}from"../chunks/DbymgH-s.js";import{a as et,b as $t,d as wt}from"../chunks/DJ82hxZh.js";import{C as Ct,a as tt,S as kt,E as St,e as st,g as rt,f as Ot,c as Mt,w as He,h as Et,O as At,d as _e,b as ot,n as gt,m as at,P as Tt,t as Le}from"../chunks/CDikZmMi.js";import{a as Ie}from"../chunks/BpF_tA7R.js";import{_ as Ft}from"../chunks/D9Z9MdNV.js";import{o as zt,a as Lt}from"../chunks/CkvGVB7_.js";import{d as Dt}from"../chunks/BA38GEDr.js";const It=Symbol();class Rt extends URLSearchParams{#e=se(0);#s=Nt();#t=!1;#r(){if(!this.#s||this.#t)return;this.#t=!0;const e=this.toString();this.#s.search=e&&`?${e}`,this.#t=!1}[It](e){if(!this.#t){this.#t=!0;for(const s of[...super.keys()])super.delete(s);for(const[s,o]of e)super.append(s,o);Ue(this.#e),this.#t=!1}}append(e,s){super.append(e,s),this.#r(),Ue(this.#e)}delete(e,s){var o=super.has(e,s);super.delete(e,s),o&&(this.#r(),Ue(this.#e))}get(e){return t(this.#e),super.get(e)}getAll(e){return t(this.#e),super.getAll(e)}has(e,s){return t(this.#e),super.has(e,s)}keys(){return t(this.#e),super.keys()}set(e,s){var o=super.getAll(e).join("");super.set(e,s),o!==super.getAll(e).join("")&&(this.#r(),Ue(this.#e))}sort(){super.sort(),this.#r(),Ue(this.#e)}toString(){return t(this.#e),super.toString()}values(){return t(this.#e),super.values()}entries(){return t(this.#e),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return t(this.#e),super.size}}let jt=null;function Nt(){return jt}const it=Mt({component:"collapsible",parts:["root","content","trigger"]}),nt=new Ct("Collapsible.Root");class lt{static create(e){return nt.set(new lt(e))}opts;attachment;#e=se(null);get contentNode(){return t(this.#e)}set contentNode(e){p(this.#e,e,!0)}#s=se(void 0);get contentId(){return t(this.#s)}set contentId(e){p(this.#s,e,!0)}constructor(e){this.opts=e,this.toggleOpen=this.toggleOpen.bind(this),this.attachment=tt(this.opts.ref),new At({ref:_e(()=>this.contentNode),open:this.opts.open,onComplete:()=>{this.opts.onOpenChangeComplete.current(this.opts.open.current)}})}toggleOpen(){this.opts.open.current=!this.opts.open.current}#t=S(()=>({id:this.opts.id.current,"data-state":rt(this.opts.open.current),"data-disabled":st(this.opts.disabled.current),[it.root]:"",...this.attachment}));get props(){return t(this.#t)}set props(e){p(this.#t,e)}}class dt{static create(e){return new dt(e,nt.get())}opts;root;attachment;#e=S(()=>this.opts.hiddenUntilFound.current?this.root.opts.open.current:this.opts.forceMount.current||this.root.opts.open.current);get present(){return t(this.#e)}set present(e){p(this.#e,e)}#s;#t=se(!1);#r=se(0);#o=se(0);constructor(e,s){this.opts=e,this.root=s,p(this.#t,s.opts.open.current,!0),this.root.contentId=this.opts.id.current,this.attachment=tt(this.opts.ref,o=>this.root.contentNode=o),He.pre(()=>this.opts.id.current,o=>{this.root.contentId=o}),_t(()=>{const o=requestAnimationFrame(()=>{p(this.#t,!1)});return()=>{cancelAnimationFrame(o)}}),He.pre([()=>this.opts.ref.current,()=>this.opts.hiddenUntilFound.current],([o,d])=>!o||!d?void 0:yt(o,"beforematch",()=>{this.root.opts.open.current||requestAnimationFrame(()=>{this.root.opts.open.current=!0})})),He([()=>this.opts.ref.current,()=>this.present],([o])=>{o&&Et(()=>{if(!this.opts.ref.current)return;this.#s=this.#s||{transitionDuration:o.style.transitionDuration,animationName:o.style.animationName},o.style.transitionDuration="0s",o.style.animationName="none";const d=o.getBoundingClientRect();if(p(this.#o,d.height,!0),p(this.#r,d.width,!0),!t(this.#t)){const{animationName:_,transitionDuration:j}=this.#s;o.style.transitionDuration=j,o.style.animationName=_}})})}#a=S(()=>({open:this.root.opts.open.current}));get snippetProps(){return t(this.#a)}set snippetProps(e){p(this.#a,e)}#i=S(()=>({id:this.opts.id.current,style:{"--bits-collapsible-content-height":t(this.#o)?`${t(this.#o)}px`:void 0,"--bits-collapsible-content-width":t(this.#r)?`${t(this.#r)}px`:void 0},hidden:this.opts.hiddenUntilFound.current&&!this.root.opts.open.current?"until-found":void 0,"data-state":rt(this.root.opts.open.current),"data-disabled":st(this.root.opts.disabled.current),[it.content]:"",...this.attachment}));get props(){return t(this.#i)}set props(e){p(this.#i,e)}}class ct{static create(e){return new ct(e,nt.get())}opts;root;attachment;#e=S(()=>this.opts.disabled.current||this.root.opts.disabled.current);constructor(e,s){this.opts=e,this.root=s,this.attachment=tt(this.opts.ref),this.onclick=this.onclick.bind(this),this.onkeydown=this.onkeydown.bind(this)}onclick(e){if(!t(this.#e)){if(e.button!==0)return e.preventDefault();this.root.toggleOpen()}}onkeydown(e){t(this.#e)||(e.key===kt||e.key===St)&&(e.preventDefault(),this.root.toggleOpen())}#s=S(()=>({id:this.opts.id.current,type:"button",disabled:t(this.#e),"aria-controls":this.root.contentId,"aria-expanded":Ot(this.root.opts.open.current),"data-state":rt(this.root.opts.open.current),"data-disabled":st(t(this.#e)),[it.trigger]:"",onclick:this.onclick,onkeydown:this.onkeydown,...this.attachment}));get props(){return t(this.#s)}set props(e){p(this.#s,e)}}var Vt=w("<div><!></div>");function Yt(Q,e){const s=Je();Oe(e,!0);let o=B(e,"id",19,()=>ot(s)),d=B(e,"ref",15,null),_=B(e,"open",15,!1),j=B(e,"disabled",3,!1),z=B(e,"onOpenChange",3,gt),i=B(e,"onOpenChangeComplete",3,gt),m=Ve(e,["$$slots","$$events","$$legacy","children","child","id","ref","open","disabled","onOpenChange","onOpenChangeComplete"]);const N=lt.create({open:_e(()=>_(),K=>{_(K),z()(K)}),disabled:_e(()=>j()),id:_e(()=>o()),ref:_e(()=>d(),K=>d(K)),onOpenChangeComplete:_e(()=>i())}),L=S(()=>at(m,N.props));var ie=ye(),X=R(ie);{var Z=K=>{var $=ye(),C=R($);Ne(C,()=>e.child,()=>({props:t(L)})),a(K,$)},ne=K=>{var $=Vt();et($,()=>({...t(L)}));var C=c($);Ne(C,()=>e.children??Xe),l($),a(K,$)};J(X,K=>{e.child?K(Z):K(ne,!1)})}a(Q,ie),Me()}var qt=w("<div><!></div>");function Ut(Q,e){const s=Je();Oe(e,!0);let o=B(e,"ref",15,null),d=B(e,"forceMount",3,!1),_=B(e,"hiddenUntilFound",3,!1),j=B(e,"id",19,()=>ot(s)),z=Ve(e,["$$slots","$$events","$$legacy","child","ref","forceMount","hiddenUntilFound","children","id"]);const i=dt.create({id:_e(()=>j()),forceMount:_e(()=>d()),hiddenUntilFound:_e(()=>_()),ref:_e(()=>o(),m=>o(m))});Tt(Q,{forceMount:!0,get open(){return i.present},get ref(){return i.opts.ref},presence:(N,L)=>{let ie=()=>L?.().present;const X=S(()=>at(z,i.props,_()&&!ie()?{}:{hidden:_()?!ie():d()?void 0:!ie()}));var Z=ye(),ne=R(Z);{var K=C=>{var re=ye(),ue=R(re);{let me=S(()=>({...i.snippetProps,props:t(X)}));Ne(ue,()=>e.child,()=>t(me))}a(C,re)},$=C=>{var re=qt();et(re,()=>({...t(X)}));var ue=c(re);Ne(ue,()=>e.children??Xe),l(re),a(C,re)};J(ne,C=>{e.child?C(K):C($,!1)})}a(N,Z)},$$slots:{presence:!0}}),Me()}var Bt=w("<button><!></button>");function Qt(Q,e){const s=Je();Oe(e,!0);let o=B(e,"ref",15,null),d=B(e,"id",19,()=>ot(s)),_=B(e,"disabled",3,!1),j=Ve(e,["$$slots","$$events","$$legacy","children","child","ref","id","disabled"]);const z=ct.create({id:_e(()=>d()),ref:_e(()=>o(),X=>o(X)),disabled:_e(()=>_())}),i=S(()=>at(j,z.props));var m=ye(),N=R(m);{var L=X=>{var Z=ye(),ne=R(Z);Ne(ne,()=>e.child,()=>({props:t(i)})),a(X,Z)},ie=X=>{var Z=Bt();et(Z,()=>({...t(i)}));var ne=c(Z);Ne(ne,()=>e.children??Xe),l(Z),a(X,Z)};J(N,X=>{e.child?X(L):X(ie,!1)})}a(Q,m),Me()}function ft(Q,e){Oe(e,!0);let s=B(e,"ref",15,null),o=B(e,"open",15,!1),d=Ve(e,["$$slots","$$events","$$legacy","ref","open"]);var _=ye(),j=R(_);De(j,()=>Yt,(z,i)=>{i(z,Ze({"data-slot":"collapsible"},()=>d,{get ref(){return s()},set ref(m){s(m)},get open(){return o()},set open(m){o(m)}}))}),a(Q,_),Me()}function vt(Q,e){Oe(e,!0);let s=B(e,"ref",15,null),o=Ve(e,["$$slots","$$events","$$legacy","ref"]);var d=ye(),_=R(d);De(_,()=>Qt,(j,z)=>{z(j,Ze({"data-slot":"collapsible-trigger"},()=>o,{get ref(){return s()},set ref(i){s(i)}}))}),a(Q,d),Me()}function ht(Q,e){Oe(e,!0);let s=B(e,"ref",15,null),o=Ve(e,["$$slots","$$events","$$legacy","ref"]);var d=ye(),_=R(d);De(_,()=>Ut,(j,z)=>{z(j,Ze({"data-slot":"collapsible-content"},()=>o,{get ref(){return s()},set ref(i){s(i)}}))}),a(Q,d),Me()}class Kt{#e=se(Be({source:"all",severity:[],tags:[],author:[],timeRange:"all",favorites:!1,searchQuery:""}));get filters(){return t(this.#e)}set filters(e){p(this.#e,e,!0)}#s=se(Be([]));get pocs(){return t(this.#s)}set pocs(e){p(this.#s,e,!0)}#t=se(Be({total:0,builtin:0,curated:0,my:0,bySeverity:{critical:0,high:0,medium:0,low:0,info:0},topTags:[],topAuthors:[]}));get stats(){return t(this.#t)}set stats(e){p(this.#t,e,!0)}#r=se(null);get selectedPoc(){return t(this.#r)}set selectedPoc(e){p(this.#r,e,!0)}#o=se(!1);get loading(){return t(this.#o)}set loading(e){p(this.#o,e,!0)}#a=se(!1);get sidebarCollapsed(){return t(this.#a)}set sidebarCollapsed(e){p(this.#a,e,!0)}#i=se(Be({page:1,pageSize:20,total:0}));get pagination(){return t(this.#i)}set pagination(e){p(this.#i,e,!0)}async loadPocs(){this.loading=!0;try{const e=new Rt;this.filters.source!=="all"&&e.append("source",this.filters.source),this.filters.severity.length>0&&e.append("severity",this.filters.severity.join(",")),this.filters.tags.length>0&&e.append("tags",this.filters.tags.join(",")),this.filters.author.length>0&&e.append("author",this.filters.author.join(",")),this.filters.timeRange!=="all"&&e.append("time_range",this.filters.timeRange),this.filters.favorites&&e.append("favorites","true"),this.filters.searchQuery&&e.append("q",this.filters.searchQuery),e.append("page",this.pagination.page.toString()),e.append("page_size",this.pagination.pageSize.toString());const s=await Ie.get(`/pocs?${e.toString()}`);s.success&&s.data?s.data.items?(this.pocs=s.data.items,this.pagination.total=s.data.total||0):Array.isArray(s.data)?(this.pocs=s.data,this.pagination.total=s.data.length):(this.pocs=[],this.pagination.total=0):(this.pocs=[],this.pagination.total=0)}catch(e){console.error("Failed to load POCs:",e),this.pocs=[],this.pagination.total=0}finally{this.loading=!1}}async loadStats(){try{const e=await Ie.loadPocsStats();if(e.success&&e.data){const s=e.data;this.stats={total:s?.total??0,builtin:s?.by_source?.builtin??0,curated:s?.by_source?.curated??0,my:s?.by_source?.my??0,bySeverity:{critical:s?.by_severity?.critical??0,high:s?.by_severity?.high??0,medium:s?.by_severity?.medium??0,low:s?.by_severity?.low??0,info:s?.by_severity?.info??0},topTags:s?.top_tags??[],topAuthors:s?.top_authors??[]}}}catch(e){console.error("Failed to load POC stats:",e)}}async searchPocs(e){this.filters.searchQuery=e,this.pagination.page=1,await Promise.all([this.loadPocs(),this.loadStats()])}async updateFilters(e){this.filters={...this.filters,...e},this.pagination.page=1,await Promise.all([this.loadPocs(),this.loadStats()])}async selectPoc(e){if(this.selectedPoc=e,e&&!e.yaml_content){const s=e.poc_id||e.id?.toString();s?await this.loadPocContent(s):console.warn("POC has no valid ID:",e)}}async loadPocContent(e){try{const s=await Ie.getPocYamlContent(e);if(s.success&&s.data&&this.selectedPoc){this.selectedPoc.yaml_content=s.data;const o=this.pocs.findIndex(d=>d.poc_id&&d.poc_id===e||d.id&&d.id.toString()===e);o!==-1&&(this.pocs[o].yaml_content=s.data)}}catch(s){console.error("Failed to load POC content:",s)}}async deletePoc(e){try{(await Ie.delete(`/pocs/${e}`)).success&&(this.pocs=this.pocs.filter(o=>o.poc_id!==e),this.selectedPoc?.poc_id===e&&(this.selectedPoc=null),await this.loadStats())}catch(s){console.error("Failed to delete POC:",s)}}async syncCuratedPocs(){try{(await Ie.post("/pocs/curated/sync")).success&&await Promise.all([this.loadPocs(),this.loadStats()])}catch(e){console.error("Failed to sync Curated POCs:",e)}}toggleSidebar(){this.sidebarCollapsed=!this.sidebarCollapsed}async goToPage(e){this.pagination.page=e,await Promise.all([this.loadPocs(),this.loadStats()])}async changePageSize(e){this.pagination.pageSize=e,this.pagination.page=1,await Promise.all([this.loadPocs(),this.loadStats()])}async init(){await Promise.all([this.loadPocs(),this.loadStats()])}}const r=new Kt;var Wt=w('<span class="text-sm">全部 PoCs</span> <!>',1),Gt=w('<span class="text-sm">公共 PoCs</span> <!>',1),Ht=w('<span class="text-sm">精选 PoCs</span> <!>',1),Jt=w('<span class="text-sm">我的 PoCs</span> <!>',1),Xt=w('<span class="text-sm capitalize"> </span> <!>',1),Zt=w('<div class="flex items-center gap-2"><!></div> <!>',1),es=w('<span class="text-sm w-full truncate"> </span> <!>',1),ts=w('<div class="space-y-2"><!> <!> <!></div>'),ss=w('<div class="text-sm text-muted-foreground p-2">暂无标签数据</div>'),rs=w('<div class="p-4 border-b"><!> <!></div>'),os=w('<div class="flex items-center gap-2"><!></div> <!>',1),as=w('<span class="text-sm w-full truncate"> </span> <!>',1),is=w('<div class="space-y-2"><!> <!> <!></div>'),ns=w('<div class="p-4 border-b"><!> <!></div>'),ls=w('<div class="w-64 h-full bg-card border-r flex flex-col"><div class="p-4 border-b"><h2 class="font-semibold text-lg">POC 管理</h2></div> <div class="flex-1 overflow-y-auto"><div class="p-4 border-b"><div class="relative"><!> <!></div></div> <div class="p-4 border-b"><div class="space-y-2"><!> <!> <!> <!></div></div> <div class="p-4 border-b"><div class="space-y-2"></div></div> <!> <!> <div class="p-4 border-b"><div class="flex items-center gap-2 mb-3"><!></div> <div class="space-y-2"><div class="grid grid-cols-2 gap-2"><!> <!></div></div></div></div> <div class="p-4 border-t"><!></div></div>');function ds(Q,e){Oe(e,!0);let s=B(e,"stats",19,()=>r.stats);B(e,"loading",19,()=>r.loading);let o=Be({tags:!1,authors:!1});function d(v){const y=[...r.filters.severity];y.includes(v)?r.updateFilters({severity:y.filter(I=>I!==v)}):r.updateFilters({severity:[...y,v]})}function _(v){const y=[...r.filters.tags];y.includes(v)?r.updateFilters({tags:y.filter(I=>I!==v)}):r.updateFilters({tags:[...y,v]})}function j(v){const y=[...r.filters.author];y.includes(v)?r.updateFilters({author:y.filter(I=>I!==v)}):r.updateFilters({author:[...y,v]})}function z(){r.updateFilters({source:"all",severity:[],tags:[],author:[],timeRange:"all",favorites:!1,searchQuery:""})}const i=["critical","high","medium","low","info"];var m=ls(),N=u(c(m),2),L=c(N),ie=c(L),X=c(ie);bt(X,{class:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"});var Z=u(X,2);xt(Z,{placeholder:"搜索 POC...",class:"pl-9",onkeydown:v=>{v.key==="Enter"&&r.searchPocs(r.filters.searchQuery)},get value(){return r.filters.searchQuery},set value(v){r.filters.searchQuery=v}}),l(ie),l(L);var ne=u(L,2),K=c(ne),$=c(K);{let v=S(()=>r.filters.source==="all"?"bg-muted":"");G($,{get class(){return`w-full flex items-center justify-between p-2 rounded-md hover:bg-muted transition-colors text-left no-underline ${t(v)??""}`},onclick:()=>r.updateFilters({source:"all"}),variant:"ghost",children:(y,I)=>{var n=Wt(),h=u(R(n),2);ve(h,{variant:"secondary",children:(P,g)=>{x();var f=b();F(()=>O(f,s().total)),a(P,f)},$$slots:{default:!0}}),a(y,n)},$$slots:{default:!0}})}var C=u($,2);{let v=S(()=>r.filters.source==="builtin"?"bg-muted":"");G(C,{get class(){return`w-full flex items-center justify-between p-2 rounded-md un hover:bg-muted transition-colors text-left no-underline ${t(v)??""}`},onclick:()=>r.updateFilters({source:"builtin"}),variant:"ghost",children:(y,I)=>{var n=Gt(),h=u(R(n),2);ve(h,{variant:"secondary",children:(P,g)=>{x();var f=b();F(()=>O(f,s().builtin)),a(P,f)},$$slots:{default:!0}}),a(y,n)},$$slots:{default:!0}})}var re=u(C,2);{let v=S(()=>r.filters.source==="curated"?"bg-muted":"");G(re,{get class(){return`w-full flex items-center justify-between p-2 rounded-md un hover:bg-muted transition-colors text-left no-underline ${t(v)??""}`},onclick:()=>r.updateFilters({source:"curated"}),variant:"ghost",children:(y,I)=>{var n=Ht(),h=u(R(n),2);ve(h,{variant:"secondary",children:(P,g)=>{x();var f=b();F(()=>O(f,s().curated)),a(P,f)},$$slots:{default:!0}}),a(y,n)},$$slots:{default:!0}})}var ue=u(re,2);{let v=S(()=>r.filters.source==="my"?"bg-muted":"");G(ue,{get class(){return`w-full flex items-center justify-between p-2 rounded-md hover:bg-muted transition-colors text-left no-underline ${t(v)??""}`},onclick:()=>r.updateFilters({source:"my"}),variant:"ghost",children:(y,I)=>{var n=Jt(),h=u(R(n),2);ve(h,{variant:"secondary",children:(P,g)=>{x();var f=b();F(()=>O(f,s().my)),a(P,f)},$$slots:{default:!0}}),a(y,n)},$$slots:{default:!0}})}l(K),l(ne);var me=u(ne,2),Ae=c(me);je(Ae,21,()=>i,Qe,(v,y)=>{{let I=S(()=>r.filters.severity.includes(t(y))?"bg-muted":"");G(v,{get class(){return`w-full flex items-center justify-between p-2 rounded-md hover:bg-muted transition-colors text-left no-underline ${t(I)??""}`},onclick:()=>d(t(y)),variant:"ghost",children:(n,h)=>{var P=Xt(),g=R(P),f=c(g,!0);l(g);var H=u(g,2);ve(H,{variant:"secondary",children:(q,ee)=>{x();var A=b();F(()=>O(A,s().bySeverity[t(y)])),a(q,A)},$$slots:{default:!0}}),F(()=>O(f,t(y))),a(n,P)},$$slots:{default:!0}})}}),l(Ae),l(me);var Ee=u(me,2);De(Ee,()=>ft,(v,y)=>{y(v,{children:(I,n)=>{var h=rs(),P=c(h);De(P,()=>vt,(f,H)=>{H(f,{class:"flex items-center justify-between w-full mb-3",children:(q,ee)=>{var A=Zt(),W=R(A),te=c(W);Ge(te,{class:"font-medium",children:(T,U)=>{x();var E=b("按标签分类");a(T,E)},$$slots:{default:!0}}),l(W);var Se=u(W,2);{let T=S(()=>`w-4 h-4 transition-transform ${o.tags?"rotate-180":""}`);ut(Se,{get class(){return t(T)}})}a(q,A)},$$slots:{default:!0}})});var g=u(P,2);De(g,()=>ht,(f,H)=>{H(f,{children:(q,ee)=>{var A=ye(),W=R(A);{var te=T=>{var U=ts(),E=c(U);je(E,17,()=>s().topTags.slice(0,o.tags?s().topTags.length:5),Qe,(ae,ge)=>{let $e=()=>t(ge).tag,pe=()=>t(ge).count;{let ce=S(()=>r.filters.tags.includes($e())?"bg-muted":"");G(ae,{get class(){return`w-full flex items-center justify-between p-2 rounded-md hover:bg-muted transition-colors text-left no-underline ${t(ce)??""}`},onclick:()=>_($e()),variant:"ghost",children:(we,Fe)=>{var Ce=es(),fe=R(Ce),ze=c(fe,!0);l(fe);var Ye=u(fe,2);ve(Ye,{variant:"outline",children:(Ke,We)=>{x();var qe=b();F(()=>O(qe,pe())),a(Ke,qe)},$$slots:{default:!0}}),F(()=>O(ze,$e())),a(we,Ce)},$$slots:{default:!0}})}});var oe=u(E,2);{var he=ae=>{G(ae,{variant:"ghost",size:"sm",class:"w-full",onclick:()=>{o.tags=!0},children:(ge,$e)=>{x();var pe=b();F(()=>O(pe,`显示更多... (${s().topTags.length-5} 个)`)),a(ge,pe)},$$slots:{default:!0}})};J(oe,ae=>{!o.tags&&s().topTags.length>5&&ae(he)})}var be=u(oe,2);{var xe=ae=>{G(ae,{variant:"ghost",size:"sm",class:"w-full",onclick:()=>{o.tags=!1},children:(ge,$e)=>{x();var pe=b("收起");a(ge,pe)},$$slots:{default:!0}})};J(be,ae=>{o.tags&&s().topTags.length>5&&ae(xe)})}l(U),a(T,U)},Se=T=>{var U=ss();a(T,U)};J(W,T=>{s().topTags.length>0?T(te):T(Se,!1)})}a(q,A)},$$slots:{default:!0}})}),l(h),a(I,h)},$$slots:{default:!0}})});var k=u(Ee,2);De(k,()=>ft,(v,y)=>{y(v,{children:(I,n)=>{var h=ns(),P=c(h);De(P,()=>vt,(f,H)=>{H(f,{class:"flex items-center justify-between w-full mb-3",children:(q,ee)=>{var A=os(),W=R(A),te=c(W);Ge(te,{class:"font-medium",children:(T,U)=>{x();var E=b("按作者分类");a(T,E)},$$slots:{default:!0}}),l(W);var Se=u(W,2);{let T=S(()=>`w-4 h-4 transition-transform ${o.authors?"rotate-180":""}`);ut(Se,{get class(){return t(T)}})}a(q,A)},$$slots:{default:!0}})});var g=u(P,2);De(g,()=>ht,(f,H)=>{H(f,{children:(q,ee)=>{var A=is(),W=c(A);je(W,17,()=>s().topAuthors.slice(0,o.authors?s().topAuthors.length:5),Qe,(E,oe)=>{let he=()=>t(oe).author,be=()=>t(oe).count;{let xe=S(()=>r.filters.author.includes(he())?"bg-muted":"");G(E,{get class(){return`w-full flex items-center justify-between p-2 rounded-md hover:bg-muted transition-colors text-left no-underline ${t(xe)??""}`},onclick:()=>j(he()),variant:"ghost",children:(ae,ge)=>{var $e=as(),pe=R($e),ce=c(pe,!0);l(pe);var we=u(pe,2);ve(we,{variant:"outline",children:(Fe,Ce)=>{x();var fe=b();F(()=>O(fe,be())),a(Fe,fe)},$$slots:{default:!0}}),F(()=>O(ce,he())),a(ae,$e)},$$slots:{default:!0}})}});var te=u(W,2);{var Se=E=>{G(E,{variant:"ghost",size:"sm",class:"w-full",onclick:()=>o.authors=!0,children:(oe,he)=>{x();var be=b();F(()=>O(be,`显示更多... (${s().topAuthors.length-5} 个)`)),a(oe,be)},$$slots:{default:!0}})};J(te,E=>{!o.authors&&s().topAuthors.length>5&&E(Se)})}var T=u(te,2);{var U=E=>{G(E,{variant:"ghost",size:"sm",class:"w-full",onclick:()=>o.authors=!1,children:(oe,he)=>{x();var be=b("收起");a(oe,be)},$$slots:{default:!0}})};J(T,E=>{o.authors&&s().topAuthors.length>5&&E(U)})}l(A),a(q,A)},$$slots:{default:!0}})}),l(h),a(I,h)},$$slots:{default:!0}})});var M=u(k,2),D=c(M),le=c(D);Ge(le,{class:"font-medium",children:(v,y)=>{x();var I=b("快速筛选");a(v,I)},$$slots:{default:!0}}),l(D);var ke=u(D,2),Y=c(ke),Pe=c(Y);{let v=S(()=>r.filters.timeRange==="today"?"default":"outline");G(Pe,{get variant(){return t(v)},size:"sm",onclick:()=>r.updateFilters({timeRange:r.filters.timeRange==="today"?"all":"today"}),children:(y,I)=>{x();var n=b("今天");a(y,n)},$$slots:{default:!0}})}var de=u(Pe,2);{let v=S(()=>r.filters.timeRange==="week"?"default":"outline");G(de,{get variant(){return t(v)},size:"sm",onclick:()=>r.updateFilters({timeRange:r.filters.timeRange==="week"?"all":"week"}),children:(y,I)=>{x();var n=b("本周");a(y,n)},$$slots:{default:!0}})}l(Y),l(ke),l(M),l(N);var Te=u(N,2),V=c(Te);G(V,{variant:"outline",size:"sm",class:"w-full",onclick:z,children:(v,y)=>{x();var I=b("清空筛选");a(v,I)},$$slots:{default:!0}}),l(Te),l(m),a(Q,m),Me()}var cs=w('<div class="flex items-center justify-center h-32"><div class="text-muted-foreground">加载中...</div></div>'),us=w('<div class="flex items-center justify-center h-32"><div class="text-muted-foreground"></div></div>'),gs=(Q,e,s)=>e(t(s)),fs=w("<!> <!>",1),vs=w("<!> <!>",1),hs=w('<div class="flex flex-wrap gap-1 mt-2"><!></div>'),ps=w('<button type="button"><div class="flex-1 min-w-0"><div class="flex items-center justify-between mb-1"><div class="flex items-center gap-2"><span class="text-xs text-muted-foreground truncate max-w-[100px]"> </span> <!></div> <div class="flex items-center gap-2 text-xs text-muted-foreground"><span> </span></div></div> <div class="font-sm text-foreground mb-1 truncate"> </div> <div class="text-sm text-muted-foreground line-clamp-2 leading-relaxed svelte-efadq"> </div> <!></div></button>'),ms=w('<div class="flex flex-col h-full bg-background"><div class="flex items-center justify-between p-4 border-b"><div class="flex items-center gap-2"><h1 class="text-lg font-semibold">POC 列表</h1> <!></div></div> <div class="flex-1 overflow-auto"><!></div> <div class="p-3 border-t flex items-center justify-between"><div class="text-sm text-muted-foreground"> </div> <div class="flex items-center gap-2"><!> <!></div></div></div>');function _s(Q,e){Oe(e,!0);let s="",o=se(null),d=S(()=>{if(!r.pocs)return[];let k=r.pocs;if(s.trim()){const M=s.toLowerCase();k=k.filter(D=>D.name.toLowerCase().includes(M)||D.author&&typeof D.author=="string"&&D.author.toLowerCase().includes(M)||D.description.toLowerCase().includes(M)||D.tags&&typeof D.tags=="string"&&D.tags.toLowerCase().includes(M))}return k});function _(){r.pagination.page>1&&r.goToPage(r.pagination.page-1)}function j(){const k=Math.max(1,Math.ceil(r.pagination.total/r.pagination.pageSize));r.pagination.page<k&&r.goToPage(r.pagination.page+1)}async function z(k){p(o,k,!0),await r.selectPoc(k)}function i(k){switch((k??"").toLowerCase()){case"critical":return"bg-fuchsia-100 text-fuchsia-800 border-fuchsia-200 dark:bg-fuchsia-900/20 dark:text-fuchsia-400 dark:border-fuchsia-800";case"high":return"bg-red-100 text-red-800 border-red-200 dark:bg-red-900/20 dark:text-red-400 dark:border-red-800";case"medium":case"midium":return"bg-orange-100 text-orange-800 border-orange-200 dark:bg-orange-900/20 dark:text-orange-400 dark:border-orange-800";case"low":return"bg-blue-100 text-blue-800 border-blue-200 dark:bg-blue-900/20 dark:text-blue-400 dark:border-blue-800";case"info":return"bg-gray-100 text-gray-800 border-gray-200 dark:bg-gray-900/20 dark:text-gray-400 dark:border-gray-800";default:return"bg-gray-100 text-gray-800 border-gray-200 dark:bg-gray-900/20 dark:text-gray-400 dark:border-gray-800"}}var m=ms(),N=c(m),L=c(N),ie=u(c(L),2);{var X=k=>{ve(k,{variant:"secondary",class:"ml-2",children:(M,D)=>{x();var le=b();F(()=>O(le,r.pagination.total)),a(M,le)},$$slots:{default:!0}})};J(ie,k=>{r.pagination.total&&k(X)})}l(L),l(N);var Z=u(N,2),ne=c(Z);{var K=k=>{var M=cs();a(k,M)},$=k=>{var M=ye(),D=R(M);{var le=Y=>{var Pe=us(),de=c(Pe);de.textContent="暂无 POC 数据",l(Pe),a(Y,Pe)},ke=Y=>{var Pe=ye(),de=R(Pe);je(de,19,()=>t(d),(Te,V)=>Te.poc_id||Te.id||V,(Te,V)=>{var v=ps();v.__click=[gs,z,V];var y=c(v),I=c(y),n=c(I),h=c(n),P=c(h,!0);l(h);var g=u(h,2);{let U=S(()=>`${i(t(V).severity)} lowercase`);ve(g,{variant:"secondary",get class(){return t(U)},children:(E,oe)=>{x();var he=b();F(()=>O(he,t(V).severity)),a(E,he)},$$slots:{default:!0}})}l(n);var f=u(n,2),H=c(f),q=c(H,!0);l(H),l(f),l(I);var ee=u(I,2),A=c(ee,!0);l(ee);var W=u(ee,2),te=c(W,!0);l(W);var Se=u(W,2);{var T=U=>{var E=hs(),oe=c(E);{var he=xe=>{var ae=fs(),ge=R(ae);je(ge,17,()=>t(V).tags.split(",").slice(0,4),Qe,(ce,we)=>{ve(ce,{variant:"outline",class:"text-xs px-1.5 py-0.5",children:(Fe,Ce)=>{x();var fe=b();F(ze=>O(fe,ze),[()=>t(we).trim()]),a(Fe,fe)},$$slots:{default:!0}})});var $e=u(ge,2);{var pe=ce=>{ve(ce,{variant:"outline",class:"text-xs px-1.5 py-0.5",children:(we,Fe)=>{x();var Ce=b();F(fe=>O(Ce,`+${fe??""}`),[()=>t(V).tags.split(",").length-4]),a(we,Ce)},$$slots:{default:!0}})};J($e,ce=>{t(V).tags.split(",").length>4&&ce(pe)})}a(xe,ae)},be=xe=>{var ae=ye(),ge=R(ae);{var $e=ce=>{var we=vs(),Fe=R(we);je(Fe,17,()=>t(V).tags.slice(0,4),Qe,(ze,Ye)=>{ve(ze,{variant:"outline",class:"text-xs px-1.5 py-0.5",children:(Ke,We)=>{x();var qe=b();F(mt=>O(qe,mt),[()=>String(t(Ye))]),a(Ke,qe)},$$slots:{default:!0}})});var Ce=u(Fe,2);{var fe=ze=>{ve(ze,{variant:"outline",class:"text-xs px-1.5 py-0.5",children:(Ye,Ke)=>{x();var We=b();F(()=>O(We,`+${t(V).tags.length-4}`)),a(Ye,We)},$$slots:{default:!0}})};J(Ce,ze=>{t(V).tags.length>4&&ze(fe)})}a(ce,we)},pe=ce=>{ve(ce,{variant:"outline",class:"text-xs px-1.5 py-0.5",children:(we,Fe)=>{x();var Ce=b();F(fe=>O(Ce,fe),[()=>String(t(V).tags)]),a(we,Ce)},$$slots:{default:!0}})};J(ge,ce=>{Array.isArray(t(V).tags)&&t(V).tags.length>0?ce($e):ce(pe,!1)},!0)}a(xe,ae)};J(oe,xe=>{typeof t(V).tags=="string"?xe(he):xe(be,!1)})}l(E),a(U,E)};J(Se,U=>{t(V).tags&&U(T)})}l(y),l(v),F(U=>{$t(v,1,U,"svelte-efadq"),O(P,t(V).author),O(q,t(V).created),O(A,t(V).name),O(te,t(V).id||"暂无ID")},[()=>`flex items-start gap-4 p-4 border-b hover:bg-muted/50 cursor-pointer w-full text-left transition-colors ${(r.selectedPoc?.poc_id??r.selectedPoc?.id?.toString())===(t(V).poc_id??t(V).id?.toString())?"bg-muted/50":""}`]),a(Te,v)}),a(Y,Pe)};J(D,Y=>{!t(d)||t(d).length===0?Y(le):Y(ke,!1)},!0)}a(k,M)};J(ne,k=>{r.loading?k(K):k($,!1)})}l(Z);var C=u(Z,2),re=c(C),ue=c(re);l(re);var me=u(re,2),Ae=c(me);{let k=S(()=>r.pagination.page<=1);G(Ae,{variant:"outline",size:"sm",onclick:_,get disabled(){return t(k)},children:(M,D)=>{x();var le=b("上一页");a(M,le)},$$slots:{default:!0}})}var Ee=u(Ae,2);{let k=S(()=>r.pagination.page>=Math.max(1,Math.ceil(r.pagination.total/r.pagination.pageSize)));G(Ee,{variant:"outline",size:"sm",onclick:j,get disabled(){return t(k)},children:(M,D)=>{x();var le=b("下一页");a(M,le)},$$slots:{default:!0}})}l(me),l(C),l(m),F(()=>O(ue,`第 ${r.pagination.page??""} 页，共 ${r.pagination.total??""} 条`)),a(Q,m),Me()}Pt(["click"]);var ys=w('<div class="monaco-editor-container border rounded-md overflow-hidden svelte-1il5rto"></div>');function Ps(Q,e){Oe(e,!0);let s=B(e,"value",3,""),o=B(e,"language",3,"yaml"),d=B(e,"theme",3,"vs"),_=B(e,"readonly",3,!1),j=B(e,"height",3,"400px"),z=B(e,"options",19,()=>({})),i,m,N,L=!1;zt(async()=>{try{m=(await Ft(async()=>{const{default:C}=await import("../chunks/BvHLSZtD.js");return{default:C}},__vite__mapDeps([0,1]),import.meta.url)).default,console.log("Monaco Editor loaded:",{hasMonaco:!!m,languages:m?.languages?"available":"not available",editor:m?.editor?"available":"not available"}),i=m.editor.create(N,{value:s(),language:o(),theme:d(),readOnly:_(),automaticLayout:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1,fontSize:14,lineNumbers:"on",folding:!0,wordWrap:"on",tabSize:2,insertSpaces:!0,quickSuggestions:{other:!0,comments:!0,strings:!0},suggestOnTriggerCharacters:!0,acceptSuggestionOnCommitCharacter:!0,acceptSuggestionOnEnter:"off",wordBasedSuggestions:"matchingDocuments",quickSuggestionsDelay:10,parameterHints:{enabled:!0,cycle:!0},hover:{enabled:!0,delay:300},suggest:{showKeywords:!0,showSnippets:!0,showFunctions:!0,showConstructors:!0,showFields:!0,showVariables:!0,showClasses:!0,showStructs:!0,showInterfaces:!0,showModules:!0,showProperties:!0,showEvents:!0,showOperators:!0,showUnits:!0,showValues:!0,showConstants:!0,showEnums:!0,showEnumMembers:!0,showColors:!0,showFiles:!0,showReferences:!0,showFolders:!0,showTypeParameters:!0,showIssues:!0,showUsers:!0,insertMode:"insert",filterGraceful:!0,localityBonus:!0,shareSuggestSelections:!1},...z()});const $=!!i.getAction("editor.action.triggerSuggest");console.log("Suggest action availability:",$),i.onDidChangeModelContent(()=>{L&&e.onchange&&e.onchange(i.getValue())}),i.onKeyDown(C=>{console.log("Monaco key pressed:",{key:C.code,keyCode:C.keyCode,browserEvent:C.browserEvent?.key,ctrlKey:C.ctrlKey,shiftKey:C.shiftKey,position:i.getPosition()})}),i.onDidChangeModelContent(C=>{const re=i.getModel(),ue=i.getPosition();if(re&&ue){const me=re.getLineContent(ue.lineNumber),Ae=re.getWordAtPosition(ue);console.log("Monaco content changed:",{position:ue,lineContent:me,wordAtPosition:Ae,changes:C.changes.map(D=>({range:D.range,text:D.text}))});const Ee=[".",":"," "],M=C.changes[0]?.text;console.log("Checking trigger:",{lastChar:M,isTriggerChar:Ee.includes(M),lineContent:me,position:ue,changes:C.changes}),M&&Ee.includes(M)&&(console.log("Trigger character detected:",M),setTimeout(async()=>{try{console.log("Attempting to trigger suggest...");const D=i.getModel(),le=i.getPosition();if(D&&le){console.log("Triggering suggest at position:",le),i.focus();let ke=!1;try{const Y=i.getContribution("editor.contrib.suggestController");Y&&Y.triggerSuggest&&(console.log("Using suggestController.triggerSuggest()"),Y.triggerSuggest(),ke=!0)}catch(Y){console.warn("SuggestController method failed:",Y)}if(!ke)try{console.log("Trying to trigger suggest via action");const Y=i.getAction("editor.action.triggerSuggest");Y?(Y.run(),ke=!0,console.log("Action triggered successfully")):console.warn("Suggest action not found")}catch(Y){console.warn("Action trigger failed:",Y)}if(!ke){console.log("All trigger methods failed, trying manual approach");try{i._codeEditorService&&console.log("Trying editor service approach"),console.log("Attempting to retrigger completion after small delay"),setTimeout(()=>{const Pe=i.getValue(),de=i.getPosition();de&&(i.executeEdits("trigger-completion",[{range:new m.Range(de.lineNumber,de.column,de.lineNumber,de.column),text:" "}]),setTimeout(()=>{i.executeEdits("trigger-completion",[{range:new m.Range(de.lineNumber,de.column,de.lineNumber,de.column+1),text:""}])},10))},100)}catch(Y){console.warn("Manual trigger approach failed:",Y)}}}}catch(D){console.warn("Failed to trigger suggest:",D)}},50))}}),i.onDidFocusEditorText(()=>{console.log("Monaco editor focused")}),L=!0}catch($){console.error("Failed to initialize Monaco Editor:",$)}}),Re(()=>{if(console.log("Monaco Editor value effect:",{hasEditor:!!i,mounted:L,newValue:s()?.substring(0,50)+"...",newValueLength:s()?.length||0}),i&&L){const $=i.getValue();if(console.log("Monaco Editor comparing values:",{currentValueLength:$.length,newValueLength:s()?.length||0,areEqual:s()===$,currentPreview:$.substring(0,50)+"...",newPreview:(s()||"").substring(0,50)+"..."}),s()!==$){console.log("Monaco Editor updating value");const C=i.getPosition();i.setValue(s()||""),C&&s()&&i.setPosition(C)}}}),Re(()=>{console.log("Monaco Editor theme effect:",{hasEditor:!!i,hasMonaco:!!m,mounted:L,theme:d()}),i&&m&&L&&(console.log("Monaco Editor updating theme to:",d()),m.editor.setTheme(d()),setTimeout(()=>{console.log("Monaco Editor theme updated:",{requested:d(),success:!0})},100))}),Re(()=>{console.log("Monaco Editor readonly effect:",{hasEditor:!!i,mounted:L,readonly:_(),editorReadOnly:i?.getOptions()?.get(m?.editor?.EditorOption?.readOnly)}),i&&L&&(console.log("Monaco Editor updating readonly to:",_()),i.updateOptions({readOnly:_()}),setTimeout(()=>{const $=i.getOptions().get(m.editor.EditorOption.readOnly);console.log("Monaco Editor readonly updated:",{requested:_(),actual:$,success:_()===$})},100))}),Lt(()=>{i&&i.dispose(),m&&m.editor.getModels().forEach($=>$.dispose())});function ie(){return i?.getValue()||""}function X($){i&&i.setValue($)}function Z(){i&&i.focus()}function ne(){return i}var K=ys();return pt(K,$=>N=$,()=>N),F(()=>wt(K,`height: ${j()??""}; width: 100%;`)),a(Q,K),Me({getValue:ie,setValue:X,focus:Z,getEditor:ne})}var bs=w("<!> <!>",1),xs=w("<!> <!> <!>",1),$s=w('<div class="flex items-start justify-between"><div><div class="font-semibold"> </div></div> <!></div>'),ws=w('<div class="h-full flex flex-col"><div class="flex-1 min-h-0 p-4 flex flex-col gap-3 overflow-hidden"><!> <div class="flex items-center justify-between"><div class="text-sm text-muted-foreground"> </div> <!></div> <div class="flex-1 min-h-0 overflow-hidden relative"><!></div></div></div>'),Cs=w('<div class="p-4 text-sm text-muted-foreground">请选择左侧列表中的 POC 查看详情，或点击"新建 POC"创建新的 POC</div>'),ks=w('<div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50"><div class="bg-background border rounded-lg p-6 max-w-md w-full mx-4"><h3 class="text-lg font-semibold mb-2">确认删除</h3> <p class="text-sm text-muted-foreground mb-4"> </p> <div class="flex justify-end gap-2"><!> <!></div></div></div>'),Ss=w('<div class="h-full flex flex-col"><div class="p-4 border-b flex items-center justify-between"><h3 class="font-semibold text-lg">POC 详情</h3> <div class="flex items-center gap-2"><div class="text-xs text-muted-foreground mr-2"> </div> <!></div></div> <!></div> <!>',1);function Os(Q,e){Oe(e,!0);let s=se(!1),o=se(!1),d=se(""),_=se(!1),j=se(!1),z=se(void 0),i=S(()=>()=>t(s)||t(o)?t(d):r.selectedPoc?.yaml_content||"");Re(()=>{console.log("displayYamlContent changed:",{editMode:t(s),isCreating:t(o),yamlContentLength:t(d).length,selectedPocId:r.selectedPoc?.poc_id||r.selectedPoc?.id,selectedPocYamlLength:r.selectedPoc?.yaml_content?.length||0,finalContentLength:t(i)().length,selectedPocYamlPreview:r.selectedPoc?.yaml_content?.substring(0,100)||"empty"})}),Re(()=>{if(console.log("selectedPoc effect triggered:",{selectedPocId:r.selectedPoc?.poc_id||r.selectedPoc?.id,editMode:t(s),isCreating:t(o),hasYamlContent:!!r.selectedPoc?.yaml_content,pocType:t(m)(),canEdit:t(N)(),canDelete:t(L)(),filePath:r.selectedPoc?.file_path,isCurated:r.selectedPoc?.is_curated}),r.selectedPoc&&!t(s)&&!t(o)){if(console.log("Clearing yamlContent for new POC selection"),p(d,""),!r.selectedPoc.yaml_content){const n=r.selectedPoc.poc_id||r.selectedPoc.id?.toString();n&&(console.log("Loading YAML content for POC:",n),r.loadPocContent(n))}}else!r.selectedPoc&&!t(o)&&(console.log("No POC selected, clearing yamlContent"),p(d,""))});let m=S(()=>()=>r.selectedPoc?(console.log("POC Type Debug:",{poc_id:r.selectedPoc.poc_id,file_path:r.selectedPoc.file_path,is_curated:r.selectedPoc.is_curated,source:r.filters?.source}),r.selectedPoc.file_path&&r.selectedPoc.file_path.includes("/my/")?"my":r.selectedPoc.is_curated===!0?"curated":r.filters?.source==="my"||r.selectedPoc.poc_id&&(r.selectedPoc.poc_id.includes("custom-")||r.selectedPoc.poc_id.includes("user-")||r.selectedPoc.poc_id.includes("my-"))?"my":"builtin"):"unknown"),N=S(()=>()=>t(m)()==="my"),L=S(()=>()=>t(m)()==="my"),ie=S(()=>()=>{const n=!t(s)&&!t(o);return console.log("isReadOnly calculated:",{editMode:t(s),isCreating:t(o),readonly:n,pocType:t(m)(),canEdit:t(N)()}),n});const X=`id: new-poc

info:
  name: 新建 POC
  author: your-name
  severity: high
  description: |-
    描述
  tags: tag1,tag2
  created: ${new Date().toISOString().split("T")[0].replace(/-/g,"/")}

set:
  hostname: request.url.host
rules:
  r0:
    request:
      method: GET
      path: /login.html
    expression: response.status == 200 && response.body.bcontains(b'login')
expression: r0()`,Z={critical:"destructive",high:"destructive",medium:"default",low:"secondary",info:"outline"};function ne(){const n=t(i)();n&&(navigator.clipboard?.writeText(n),Le.success("YAML 内容已复制到剪贴板"))}function K(){console.log("startEdit called:",{canEdit:t(N)(),currentEditMode:t(s),selectedPoc:!!r.selectedPoc}),t(N)()&&(p(s,!0),p(d,r.selectedPoc?.yaml_content||"",!0),console.log("startEdit completed:",{editMode:t(s),yamlContentLength:t(d).length}),setTimeout(()=>{if(t(z)&&t(z).focus)t(z).focus(),console.log("Monaco Editor focused via component method");else{const n=document.querySelector(".monaco-editor textarea");n&&(n.focus(),console.log("Monaco Editor focused via DOM element"))}},200))}function $(){console.log("cancelEdit called:",{currentEditMode:t(s),currentIsCreating:t(o),yamlContentLength:t(d).length}),p(s,!1),p(o,!1),p(d,""),console.log("cancelEdit completed:",{editMode:t(s),isCreating:t(o),yamlContent:t(d).length}),setTimeout(()=>{console.log("Force update Monaco Editor after cancel")},100)}function C(){p(o,!0),p(s,!1),p(d,X),r.selectedPoc=null}async function re(){if(console.log("savePoc called:",{yamlContentLength:t(d).length,isCreating:t(o),editMode:t(s),selectedPocId:r.selectedPoc?.poc_id}),!t(d).trim()){Le.error("YAML 内容不能为空");return}if(!me(t(d))){Le.error("YAML 格式不正确，请检查语法");return}const n=t(s),h=t(o),P=t(d);p(_,!0);try{let g;if(t(o))console.log("Creating new POC"),g=await Ie.createPoc({yaml_content:t(d)}),console.log("Create POC result:",g),Le.success("POC 创建成功"),p(o,!1);else if(t(s)&&r.selectedPoc){console.log("Updating existing POC:",{poc_id:r.selectedPoc.poc_id,id:r.selectedPoc.id,name:r.selectedPoc.name});const f=r.selectedPoc.poc_id||r.selectedPoc.id?.toString();if(!f)throw new Error("POC ID 不存在，无法更新");g=await Ie.updatePoc(f,{yaml_content:t(d)}),console.log("Update POC result:",g),Le.success("POC 更新成功"),p(s,!1),r.selectedPoc&&(r.selectedPoc.yaml_content=t(d)),g.success&&g.data&&(r.selectedPoc=g.data)}if(g&&!g.success)throw new Error(g.message||"保存失败");console.log("Clearing yamlContent after save"),p(d,""),console.log("Reloading POCs"),await r.loadPocs(),console.log("savePoc completed:",{editMode:t(s),isCreating:t(o),yamlContentLength:t(d).length})}catch(g){console.error("保存失败:",g),p(s,n,!0),p(o,h,!0),p(d,P,!0),console.log("State rolled back due to error:",{editMode:t(s),isCreating:t(o),yamlContent:t(d).slice(0,50)+"..."});let f="保存失败，请重试";g instanceof Error&&(g.name==="ApiError"||g.message.includes("HTTP")?f=`API错误: ${g.message}`:g.message.includes("网络错误")||g.message.includes("fetch")?f="网络连接失败，请检查网络后重试":g.message.includes("登录过期")||g.message.includes("401")?f="登录已过期，请重新登录":g.message.includes("权限")?f="权限不足，无法执行此操作":f=`保存失败: ${g.message}`),Le.error(f)}finally{p(_,!1)}}async function ue(){if(!r.selectedPoc||!t(L)())return;const n=r.selectedPoc.poc_id||r.selectedPoc.id?.toString();if(!n){console.error("Delete POC failed: No valid POC ID found",{poc_id:r.selectedPoc.poc_id,id:r.selectedPoc.id,selectedPoc:r.selectedPoc}),Le.error("删除失败: POC ID 无效");return}console.log("Deleting POC:",{pocId:n,poc_id:r.selectedPoc.poc_id,id:r.selectedPoc.id,name:r.selectedPoc.name});try{await Ie.deletePoc(n),Le.success("POC 删除成功"),r.selectedPoc=null,p(j,!1),await r.loadPocs()}catch(h){const P=h instanceof Error?h.message:"未知错误";Le.error(`删除失败: ${P}`)}}function me(n){try{const h=n.split(`
`);let P=!1,g=!1;for(const f of h)f.trim().startsWith("id:")&&(P=!0),f.trim().startsWith("info:")&&(g=!0);return P&&g}catch{return!1}}function Ae(n){p(d,n,!0)}var Ee=Ss(),k=R(Ee),M=c(k),D=u(c(M),2),le=c(D),ke=c(le);l(le);var Y=u(le,2);{var Pe=n=>{var h=bs(),P=R(h);G(P,{variant:"outline",size:"sm",onclick:$,get disabled(){return t(_)},children:(f,H)=>{x();var q=b("取消");a(f,q)},$$slots:{default:!0}});var g=u(P,2);G(g,{size:"sm",onclick:re,get disabled(){return t(_)},children:(f,H)=>{x();var q=b();F(()=>O(q,t(_)?"保存中...":"保存")),a(f,q)},$$slots:{default:!0}}),a(n,h)},de=n=>{var h=xs(),P=R(h);G(P,{variant:"outline",size:"sm",onclick:C,children:(ee,A)=>{x();var W=b("新建 POC");a(ee,W)},$$slots:{default:!0}});var g=u(P,2);{var f=ee=>{G(ee,{variant:"outline",size:"sm",onclick:K,children:(A,W)=>{x();var te=b("编辑");a(A,te)},$$slots:{default:!0}})};J(g,ee=>{r.selectedPoc&&t(N)()&&ee(f)})}var H=u(g,2);{var q=ee=>{G(ee,{variant:"destructive",size:"sm",onclick:()=>p(j,!0),children:(A,W)=>{x();var te=b("删除");a(A,te)},$$slots:{default:!0}})};J(H,ee=>{r.selectedPoc&&t(L)()&&ee(q)})}a(n,h)};J(Y,n=>{t(o)||t(s)?n(Pe):n(de,!1)})}l(D),l(M);var Te=u(M,2);{var V=n=>{var h=ws(),P=c(h),g=c(P);{var f=T=>{var U=$s(),E=c(U),oe=c(E),he=c(oe,!0);l(oe),l(E);var be=u(E,2);ve(be,{get variant(){return Z[r.selectedPoc.severity]},class:"shrink-0 capitalize",children:(xe,ae)=>{x();var ge=b();F(()=>O(ge,r.selectedPoc.severity)),a(xe,ge)},$$slots:{default:!0}}),l(U),F(()=>O(he,r.selectedPoc.name)),a(T,U)};J(g,T=>{r.selectedPoc&&T(f)})}var H=u(g,2),q=c(H),ee=c(q,!0);l(q);var A=u(q,2);{var W=T=>{G(T,{variant:"outline",size:"sm",onclick:ne,children:(U,E)=>{x();var oe=b("复制");a(U,oe)},$$slots:{default:!0}})};J(A,T=>{t(o)||T(W)})}l(H);var te=u(H,2),Se=c(te);{let T=S(()=>t(i)()),U=S(()=>Dt.current==="dark"?"vs-dark":"vs"),E=S(()=>t(ie)());pt(Ps(Se,{get value(){return t(T)},language:"yaml",get theme(){return t(U)},get readonly(){return t(E)},height:"100%",onchange:Ae}),oe=>p(z,oe,!0),()=>t(z))}l(te),l(P),l(h),F(()=>O(ee,t(o)?"新建 POC":"YAML 内容")),a(n,h)},v=n=>{var h=Cs();a(n,h)};J(Te,n=>{r.selectedPoc||t(o)?n(V):n(v,!1)})}l(k);var y=u(k,2);{var I=n=>{var h=ks(),P=c(h),g=u(c(P),2),f=c(g);l(g);var H=u(g,2),q=c(H);G(q,{variant:"outline",size:"sm",onclick:()=>p(j,!1),children:(A,W)=>{x();var te=b("取消");a(A,te)},$$slots:{default:!0}});var ee=u(q,2);G(ee,{variant:"destructive",size:"sm",onclick:ue,children:(A,W)=>{x();var te=b("确认删除");a(A,te)},$$slots:{default:!0}}),l(H),l(P),l(h),F(()=>O(f,`确定要删除 POC "${r.selectedPoc?.name??""}" 吗？此操作不可撤销。`)),a(n,h)};J(y,n=>{t(j)&&n(I)})}F((n,h)=>O(ke,`Debug: editMode=${t(s)??""}, isCreating=${t(o)??""}, canEdit=${n??""}, canDelete=${h??""}`),[()=>t(N)(),()=>t(L)()]),a(Q,Ee),Me()}var Ms=w('<div class="flex flex-1 flex-col"><div class="flex flex-1 min-h-0"><div class="hidden xl:block w-64 border-r"><!></div> <div class="min-h-0 w-[350px]"><!></div> <div class="hidden lg:block flex-1 border-l"><!></div></div></div>');function Ks(Q,e){Oe(e,!0);let s=se(!1);Re(()=>{t(s)||(p(s,!0),r.init())});var o=Ms(),d=c(o),_=c(d),j=c(_);ds(j,{}),l(_);var z=u(_,2),i=c(z);_s(i,{}),l(z);var m=u(z,2),N=c(m);Os(N,{}),l(m),l(d),l(o),a(Q,o),Me()}export{Ks as component};
