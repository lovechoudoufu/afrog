import{g as h,a as u}from"./c0ftkk0z.js";const g="/api";class o extends Error{constructor(t,e,r){super(r),this.status=t,this.response=e,this.name="ApiError"}}class l{baseUrl;constructor(t=g){this.baseUrl=t}async request(t,e={}){const r=`${this.baseUrl}${t}`,i=h(),n={headers:{"Content-Type":"application/json",...e.headers},...e};i&&(n.headers={...n.headers,Authorization:`Bearer ${i}`});try{const s=await fetch(r,n);if(s.status===401)throw u.removeToken(),new o(401,null,"登录过期，请重新登录");if(!s.ok){const a=await s.json().catch(()=>({}));throw new o(s.status,a,a.message||`HTTP ${s.status}: ${s.statusText}`)}return await s.json()}catch(s){throw s instanceof o?s:new o(0,null,"网络错误，请检查连接后重试")}}post(t,e){return this.request(t,{method:"POST",body:e?JSON.stringify(e):void 0})}get(t){return this.request(t,{method:"GET"})}async login(t){return this.post("/login",{password:t})}async loadVulns(){return this.get("/vulns")}async loadPocsStats(){return this.get("/pocs/stats")}async loadReports(t){const e=new URLSearchParams;t?.page&&e.set("page",String(t.page)),t?.page_size&&e.set("page_size",String(t.page_size)),t?.keyword&&e.set("keyword",t.keyword),t?.severity&&e.set("severity",t.severity);const r=e.toString()?`/reports?${e.toString()}`:"/reports";return this.get(r)}}const d=new l;export{o as A,d as a};
